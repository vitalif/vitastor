## Vitastor

[Read English version](README.md)

## –ò–¥–µ—è

–Ø –≤—Å–µ–≥–æ –ª–∏—à—å —Ö–æ—á—É —Å–¥–µ–ª–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –±–ª–æ—á–Ω—É—é SDS!

Vitastor - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –±–ª–æ—á–Ω–∞—è SDS, –ø—Ä—è–º–æ–π –∞–Ω–∞–ª–æ–≥ Ceph RBD –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –°–•–î –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö
–æ–±–ª–∞—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –û–¥–Ω–∞–∫–æ, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –Ω–∏—Ö, Vitastor –±—ã—Å—Ç—Ä—ã–π –∏ –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ—Å—Ç–æ–π.
–¢–æ–ª—å–∫–æ –ø–æ–∫–∞ –º–∞–ª–µ–Ω—å–∫–∏–π :-).

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å —Å Ceph –æ–∑–Ω–∞—á–∞–µ—Ç –∑–∞–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∑–∞–ø–∏—Å–∏ —Å—Ç—Ä–æ–≥—É—é –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å,
—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ –ø–µ—Ä–≤–∏—á–Ω—ã–π OSD, —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –±–µ–∑ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ª—é–±–æ–º—É —á–∏—Å–ª—É –¥–∏—Å–∫–æ–≤ –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ —Å—Ö–µ–º–∞–º–∏
–∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ - —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –∏–ª–∏ —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –æ—à–∏–±–æ–∫.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

Vitastor –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø—É—Å–∫–∞, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ
–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∞ –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –≤–µ—Ä–æ—è—Ç–Ω—ã "–ª–æ–º–∞—é—â–∏–µ" –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–û–¥–Ω–∞–∫–æ —Å–ª–µ–¥—É—é—â–µ–µ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

- –ë–∞–∑–æ–≤–∞—è —á–∞—Å—Ç—å - –Ω–∞–¥—ë–∂–Ω–æ–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–µ –±–ª–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±–µ–∑ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ;-D
- –ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ö–µ–º –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏: —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è, XOR n+1 (1 –¥–∏—Å–∫ —á—ë—Ç–Ω–æ—Å—Ç–∏), –∫–æ–¥—ã –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –æ—à–∏–±–æ–∫
  –†–∏–¥–∞-–°–æ–ª–æ–º–æ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ jerasure —Å –ª—é–±—ã–º —á–∏—Å–ª–æ–º –¥–∏—Å–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ —á—ë—Ç–Ω–æ—Å—Ç–∏ –≤ –≥—Ä—É–ø–ø–µ
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—ã–µ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–µ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ etcd
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ OSD, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö
  - –ù–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—É–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏
  - –î–µ—Ä–µ–≤–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –≤—ã–±–æ—Ä–∞ OSD –ø–æ —Ç–µ–≥–∞–º / –∫–ª–∞—Å—Å–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (—Ç–æ–ª—å–∫–æ SSD, —Ç–æ–ª—å–∫–æ HDD) –∏ –ø–æ –ø–æ–¥–¥–µ—Ä–µ–≤—É
  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –æ—Ç–∫–∞–∑–∞ (–¥–∏—Å–∫/—Å–µ—Ä–≤–µ—Ä/—Å—Ç–æ–π–∫–∞ –∏ —Ç.–ø.)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
- –†–µ–±–∞–ª–∞–Ω—Å, —Ç–æ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É OSD (–¥–∏—Å–∫–∞–º–∏)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ "–ª–µ–Ω–∏–≤–æ–≥–æ" fsync (fsync –Ω–µ –Ω–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é)
- –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ –≤ etcd
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–µ–∂–∏–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞
- –î—Ä–∞–π–≤–µ—Ä –¥–∏—Å–∫–∞ –¥–ª—è QEMU (—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤–Ω–µ –¥–µ—Ä–µ–≤–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ QEMU)
- –î—Ä–∞–π–≤–µ—Ä –¥–∏—Å–∫–∞ –¥–ª—è —É—Ç–∏–ª–∏—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ fio (—Ç–∞–∫–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤–Ω–µ –¥–µ—Ä–µ–≤–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ fio)
- NBD-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ —è–¥—Ä–æ–º ("–±–ª–æ—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ —Ä–µ–∂–∏–º–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
- –£—Ç–∏–ª–∏—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤/–∏–Ω–æ–¥–æ–≤ (vitastor-rm)
- –ü–∞–∫–µ—Ç—ã –¥–ª—è Debian –∏ CentOS
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ –∏ –∑–∞–Ω—è—Ç–æ–≥–æ –º–µ—Å—Ç–∞ –≤ —Ä–∞–∑—Ä–µ–∑–µ –∏–Ω–æ–¥–æ–≤
- –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏–Ω–æ–¥–æ–≤ —á–µ—Ä–µ–∑ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ etcd
- –°–Ω–∞–ø—à–æ—Ç—ã –∏ copy-on-write –∫–ª–æ–Ω—ã

## –ü–ª–∞–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- –ë–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–∏—Å–∫–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ OSD
- –î—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–ª–∞–≥–∏–Ω—ã –¥–ª—è OpenStack, Kubernetes, OpenNebula, Proxmox –∏ –¥—Ä—É–≥–∏—Ö –æ–±–ª–∞—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- iSCSI-–ø—Ä–æ–∫—Å–∏
- –¢–∞–π–º–∞—É—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ–≤
- –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º (—Å–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫)
- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö SSD+HDD —Ö—Ä–∞–Ω–∏–ª–∏—â
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RDMA –∏ NVDIMM
- Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –í–æ–∑–º–æ–∂–Ω–æ, —Å–∂–∞—Ç–∏–µ
- –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π page cache

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–∞–∫ –∂–µ, –∫–∞–∫ –∏ –≤ Ceph, –≤ Vitastor:

- –ï—Å—Ç—å –ø—É–ª—ã (pools), PG, OSD, –º–æ–Ω–∏—Ç–æ—Ä—ã, –¥–æ–º–µ–Ω—ã –æ—Ç–∫–∞–∑–∞, –¥–µ—Ä–µ–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–∞–Ω–∞–ª–æ–≥ crush-–¥–µ—Ä–µ–≤–∞).
- –û–±—Ä–∞–∑—ã –¥–µ–ª—è—Ç—Å—è –Ω–∞ –±–ª–æ–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (–æ–±—ä–µ–∫—Ç—ã), –∏ —ç—Ç–∏ –æ–±—ä–µ–∫—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ OSD.
- –£ OSD –µ—Å—Ç—å –∂—É—Ä–Ω–∞–ª –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –æ–Ω–∏ —Ç–æ–∂–µ –º–æ–≥—É—Ç —Ä–∞–∑–º–µ—â–∞—Ç—å—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –¥–∏—Å–∫–∞—Ö.
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏ —Ç–æ–∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã. –í Vitastor, –ø—Ä–∞–≤–¥–∞, –µ—Å—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ/–ª–µ–Ω–∏–≤–æ–≥–æ fsync
  (–∫–æ–º–º–∏—Ç–∞), –≤ –∫–æ—Ç–æ—Ä–æ–º fsync –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞–ø–∏—Å–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –±–æ–ª–µ–µ
  –ø—Ä–∏–≥–æ–¥–Ω—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ "–ø–ª–æ—Ö–∏—Ö" (–¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö) SSD. –û–¥–Ω–∞–∫–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏
  –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ –∞—Ç–æ–º–∞—Ä–Ω—ã.
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–æ–∂–µ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –∂–¥–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ª—é–±–æ–≥–æ –æ—Ç–∫–∞–∑–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞, —Ç–æ –µ—Å—Ç—å,
  –≤—ã —Ç–æ–∂–µ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ö–æ—Ç—å –≤–µ—Å—å –∫–ª–∞—Å—Ç–µ—Ä —Ä–∞–∑–æ–º, –∏ –∫–ª–∏–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≤–∏—Å–Ω—É—Ç,
  –Ω–æ –Ω–µ –æ—Ç–∫–ª—é—á–∞—Ç—Å—è.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –∑–Ω–∞–∫–æ–º —Å Ceph:

- OSD (Object Storage Daemon) - –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ–¥–Ω–æ–º –¥–∏—Å–∫–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
  –∑–∞–ø—Ä–æ—Å—ã —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤.
- –ü—É–ª (Pool) - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∏–º–µ—é—â–∏—Ö –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ö–µ–º—É –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ OSD.
- PG (Placement Group) - –≥—Ä—É–ø–ø–∞ –æ–±—ä–µ–∫—Ç–æ–≤, —Ö—Ä–∞–Ω–∏–º—ã—Ö –Ω–∞ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –Ω–∞–±–æ—Ä–µ —Ä–µ–ø–ª–∏–∫ (OSD).
  –ù–µ—Å–∫–æ–ª—å–∫–æ PG –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –Ω–∞–±–æ—Ä–µ —Ä–µ–ø–ª–∏–∫, –Ω–æ –æ–±—ä–µ–∫—Ç—ã –æ–¥–Ω–æ–π PG
  –≤ –Ω–æ—Ä–º–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞—Ö OSD.
- –ú–æ–Ω–∏—Ç–æ—Ä - –¥–µ–º–æ–Ω, —Ö—Ä–∞–Ω—è—â–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞.
- –î–æ–º–µ–Ω –æ—Ç–∫–∞–∑–∞ (Failure Domain) - –≥—Ä—É–ø–ø–∞ OSD, –∫–æ—Ç–æ—Ä—ã–º –≤—ã —Ä–∞–∑—Ä–µ—à–∞–µ—Ç–µ "—É–ø–∞—Å—Ç—å" –≤—Å–µ–º –≤–º–µ—Å—Ç–µ.
  –ò–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, —ç—Ç–æ –≥—Ä—É–ø–ø–∞ OSD, –≤ –∫–æ—Ç–æ—Ä—ã–µ –°–•–î –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–ø–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ
  –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –¥–æ–º–µ–Ω –æ—Ç–∫–∞–∑–∞ - —Å–µ—Ä–≤–µ—Ä, —Ç–æ –Ω–∞ –¥–≤—É—Ö –¥–∏—Å–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
  –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–∫–∞–∂–µ—Ç—Å—è 2 –∏ –±–æ–ª–µ–µ –∫–æ–ø–∏–π –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –∞ –∑–Ω–∞—á–∏—Ç, –¥–∞–∂–µ
  –µ—Å–ª–∏ –≤ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–∫–∞–∂—É—Ç –≤—Å–µ –¥–∏—Å–∫–∏, —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ—Å–∏–ª—å–Ω–æ –ø–æ—Ç–µ—Ä–µ —Ç–æ–ª—å–∫–æ 1 –∫–æ–ø–∏–∏
  –ª—é–±–æ–≥–æ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö.
- –î–µ—Ä–µ–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (Placement Tree / CRUSH Tree) - –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ OSD
  –≤ —É–∑–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–ª–µ–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–æ–º–µ–Ω—ã –æ—Ç–∫–∞–∑–∞. –¢–æ –µ—Å—Ç—å, –¥–∏—Å–∫ (OSD) –≤—Ö–æ–¥–∏—Ç –≤
  —Å–µ—Ä–≤–µ—Ä, —Å–µ—Ä–≤–µ—Ä –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–π–∫—É, —Å—Ç–æ–π–∫–∞ –≤—Ö–æ–¥–∏—Ç –≤ —Ä—è–¥, —Ä—è–¥ –≤ –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä –∏ —Ç.–ø.

–ß–µ–º Vitastor –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Ceph:

- Vitastor –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ SSD. –¢–∞–∫–∂–µ Vitastor, –≤–µ—Ä–æ—è—Ç–Ω–æ, –¥–æ–ª–∂–µ–Ω –Ω–µ–ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞—Ç—å
  —Å –∫–æ–º–±–∏–Ω–∞—Ü–∏–µ–π SSD –∏ HDD —á–µ—Ä–µ–∑ bcache, –∞ –≤ –±—É–¥—É—â–µ–º, –≤–æ–∑–º–æ–∂–Ω–æ, –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏ –Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã
  –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ SSD+HDD. –û–¥–Ω–∞–∫–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–¥–Ω–∏—Ö –ª–∏—à—å –∂—ë—Å—Ç–∫–∏—Ö –¥–∏—Å–∫–æ–≤, –≤–æ–æ–±—â–µ –±–µ–∑ SSD,
  –Ω–µ –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ, –ø–æ—ç—Ç–æ–º—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ —ç—Ç–æ—Ç –∫–µ–π—Å –º–æ–≥—É—Ç –≤–æ–æ–±—â–µ –Ω–µ —Å–æ—Å—Ç–æ—è—Ç—å—Å—è.
- OSD Vitastor –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π –∏ –≤—Å–µ–≥–¥–∞ —Ç–∞–∫–∏–º –æ—Å—Ç–∞–Ω–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Å–∞–º—ã–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã.
  –ï—Å–ª–∏ –≤–∞–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç 1 —è–¥—Ä–∞ –Ω–∞ 1 –¥–∏—Å–∫, –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∏—Ç–µ –¥–∏—Å–∫ –Ω–∞ —Ä–∞–∑–¥–µ–ª—ã –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞ –Ω—ë–º –Ω–µ—Å–∫–æ–ª—å–∫–æ OSD.
  –ù–æ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≤–∞–º —Ö–≤–∞—Ç–∏—Ç –∏ 1 —è–¥—Ä–∞ - Vitastor –Ω–µ —Ç–∞–∫ –ø—Ä–æ–∂–æ—Ä–ª–∏–≤ –∫ —Ä–µ—Å—É—Ä—Å–∞–º CPU, –∫–∞–∫ Ceph.
- –ñ—É—Ä–Ω–∞–ª –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–º—É –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è –ª–∏—à–Ω–µ–µ –≤—Ä–µ–º—è
  –Ω–∞ —á—Ç–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å –¥–∏—Å–∫–∞. –†–∞–∑–º–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ª–∏–Ω–µ–π–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–∏—Å–∫–∞ –∏ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö,
  –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 128 –ö–ë. –° –±–ª–æ–∫–æ–º 128 –ö–ë –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  –∑–∞–Ω–∏–º–∞—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 512 –ú–ë –ø–∞–º—è—Ç–∏ –Ω–∞ 1 –¢–ë –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–∏ —ç—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–µ–Ω—å—à–µ, —á–µ–º –Ω—É–∂–Ω–æ Ceph-—É).
  –ñ—É—Ä–Ω–∞–ª –≤–æ–æ–±—â–µ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–∏–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å
  —Å –∂—É—Ä–Ω–∞–ª–æ–º —Ä–∞–∑–º–µ—Ä–æ–º –≤—Å–µ–≥–æ 16 –ú–ë. –ë–æ–ª—å—à–æ–π –∂—É—Ä–Ω–∞–ª, –≤–µ—Ä–æ—è—Ç–Ω–æ, –¥–∞–∂–µ –≤—Ä–µ–¥–µ–Ω, —Ç.–∫. "–≥—Ä—è–∑–Ω—ã–µ" –∑–∞–ø–∏—Å–∏ (–∑–∞–ø–∏—Å–∏,
  –Ω–µ —Å–±—Ä–æ—à–µ–Ω–Ω—ã–µ –∏–∑ –∂—É—Ä–Ω–∞–ª–∞) —Ç–æ–∂–µ –∑–∞–Ω–∏–º–∞—é—Ç –ø–∞–º—è—Ç—å –∏ –º–æ–≥—É—Ç –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª—è—Ç—å —Ä–∞–±–æ—Ç—É.
- –í Vitastor –Ω–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ copy-on-write. –Ø —Å—á–∏—Ç–∞—é, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CoW-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≥–æ—Ä–∞–∑–¥–æ —Å–ª–æ–∂–Ω–µ–µ,
  –ø–æ—ç—Ç–æ–º—É —Å–ª–æ–∂–Ω–µ–µ –¥–æ–±–∏—Ç—å—Å—è —É—Å—Ç–æ–π—á–∏–≤–æ —Ö–æ—Ä–æ—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –í–æ–∑–º–æ–∂–Ω–æ, –≤ –æ–¥–∏–Ω –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å
  —è –ø—Ä–∏–¥—É–º–∞—é –∫—Ä–∞—Å–∏–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è CoW-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –Ω–æ –ø–æ–∫–∞ –Ω–µ—Ç - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ CoW –≤ Vitastor –Ω–µ –±—É–¥–µ—Ç.
  –í—Å—ë —ç—Ç–æ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ "–≤–Ω–µ—à–Ω–µ–º—É" CoW (—Å–Ω–∞–ø—à–æ—Ç–∞–º –∏ –∫–ª–æ–Ω–∞–º).
- –ë–∞–∑–æ–≤—ã–π —Å–ª–æ–π Vitastor - –ø—Ä–æ—Å—Ç–æ–µ –±–ª–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –±–ª–æ–∫–∞–º–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, –∞ –Ω–µ —Å–ª–æ–∂–Ω–æ–µ
  –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏, –∫–∞–∫ –≤ Ceph (RADOS).
- –í Vitastor –µ—Å—Ç—å —Ä–µ–∂–∏–º "–ª–µ–Ω–∏–≤—ã—Ö fsync", –≤ –∫–æ—Ç–æ—Ä–æ–º OSD –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º –∏—Ö
  –Ω–∞ –¥–∏—Å–∫, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –¥–µ—à—ë–≤—ã–º–∏ –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–º–∏ SSD –±–µ–∑ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–æ–≤
  ("Advanced Power Loss Protection" / "Capacitor-Based Power Loss Protection").
  –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, —Ç–∞–∫–æ–π —Ä–µ–∂–∏–º –≤—Å—ë —Ä–∞–≤–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö SSD –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ
  fsync, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
  –≤—Å—ë-—Ç–∞–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–æ—Ä–æ—à–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –¥–∏—Å–∫–∏, —Ç–µ–º –±–æ–ª–µ–µ, —Å—Ç–æ—è—Ç –æ–Ω–∏ –ø–æ—á—Ç–∏ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ.
- PG —ç—Ñ–µ–º–µ—Ä–Ω—ã. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–∞—Ö –∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö OSD.
- –ü—Ä–æ—Ü–µ—Å—Å—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –∞ –Ω–µ —Ü–µ–ª—ã–º–∏ PG.
- PGLOG-–æ–≤ –Ω–µ—Ç.
- "–ú–æ–Ω–∏—Ç–æ—Ä—ã" –Ω–µ —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ etcd –≤ –ø—Ä–æ—Å—Ç—ã—Ö —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã—Ö
  JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö. –ú–æ–Ω–∏—Ç–æ—Ä—ã Vitastor —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—è—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.
  –í —ç—Ç–æ–º —Å–º—ã—Å–ª–µ –º–æ–Ω–∏—Ç–æ—Ä Vitastor –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —Å–∏—Å—Ç–µ–º—ã –∏ –±–æ–ª—å—à–µ –ø–æ—Ö–æ–∂ –Ω–∞ Ceph-–æ–≤—Å–∫–∏–π
  –º–µ–Ω–µ–¥–∂–µ—Ä (MGR). –ú–æ–Ω–∏—Ç–æ—Ä Vitastor –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ node.js.
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PG –Ω–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã—Ö —Ö–µ—à–∞—Ö. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤—Å–µ –º–∞–ø–ø–∏–Ω–≥–∏ PG —Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä—è–º–æ –≤ etcd
  (–∏–±–æ –Ω–µ—Ç –Ω–∏–∫–∞–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Ç–µ–Ω-—Ç—ã—Å—è—á –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç–∏, –∞ –Ω–µ —Å—á–∏—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Ö–µ—à–∏).
  –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PG –ø–æ OSD –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é,
  –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ, —Å–≤–µ–¥–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∫ –õ–ü (–∑–∞–¥–∞—á–µ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è) –∏ —Ä–µ—à–µ–Ω–∏–µ –æ–Ω–æ–π —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã
  lp_solve. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ã—á–Ω–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –ø–æ—á—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å
  –æ–±—ã—á–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 96-99%, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Ceph, –≥–¥–µ –Ω–∞ –≥–æ–ª–æ–º CRUSH-–µ –±–µ–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±—ã—á–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç 80-90%.
  –¢–∞–∫–∂–µ —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—ë–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å —Å–≤—è–∑–µ–π –º–µ–∂–¥—É OSD, –∞ —Ç–∞–∫–∂–µ –º–µ–Ω—è—Ç—å
  —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é, –Ω–µ –±–æ—è—Å—å —Å–ª–æ–º–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏. –í —Ç–∞–∫–æ–º –ø–æ–¥—Ö–æ–¥–µ –µ—Å—Ç—å –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π
  –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ - –µ—Å—Ç—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ –≤ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ –æ–Ω –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è - –æ–¥–Ω–∞–∫–æ –≤–ø–ª–æ—Ç—å –¥–æ
  –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Ç–µ–Ω OSD –ø–æ–¥—Ö–æ–¥ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ù—É –∏, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ª–µ–≥–∫–æ
  —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Ö–µ—à–∏.
- –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π, –ø–æ–¥–æ–±–Ω—ã–π —Å–ª–æ—é "CRUSH-–ø—Ä–∞–≤–∏–ª", –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –í—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ —Å—Ö–µ–º—ã –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏,
  –¥–æ–º–µ–Ω—ã –æ—Ç–∫–∞–∑–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ OSD –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—É–ª–æ–≤.

## –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—É—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è

–í–∫—Ä–∞—Ç—Ü–µ: –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ö—Ä–∞–Ω–∏–ª–∫–∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤–∞–∂–Ω–µ–µ, —á–µ–º –ø–∏–∫–æ–≤—ã–µ iops-—ã.

–õ—É—á—à–∞—è –≤–æ–∑–º–æ–∂–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ 1 –ø–æ—Ç–æ–∫ —Å –≥–ª—É–±–∏–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ 1,
—á—Ç–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ
IOPS = 1/–∑–∞–¥–µ—Ä–∂–∫–∞. –ù–∏ —á–∏—Å–ª–æ–º —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–∏ –¥–∏—Å–∫–æ–≤, –Ω–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤/–ø–æ—Ç–æ–∫–æ–≤
–∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è... –û–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç —Ç–æ–≥–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä–æ –æ–¥–∏–Ω
—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–∏ –∫–ª–∏–µ–Ω—Ç) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é.

–ü–æ—á–µ–º—É –∑–∞–¥–µ—Ä–∂–∫–∏ –≤–∞–∂–Ω—ã? –ü–æ—Ç–æ–º—É, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è *–Ω–µ –º–æ–≥—É—Ç* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª—É–±–∏–Ω—É
–æ—á–µ—Ä–µ–¥–∏ –±–æ–ª—å—à–µ 1, –∏–±–æ –∏—Ö –∑–∞–¥–∞—á–∞ –Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑—É–µ—Ç—Å—è. –í–∞–∂–Ω—ã–π –ø—Ä–∏–º–µ—Ä - —ç—Ç–æ –≤—Å–µ –°–£–ë–î
—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (ACID), –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—Å–µ –æ–Ω–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –µ—ë —á–µ—Ä–µ–∑
–∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞ –∂—É—Ä–Ω–∞–ª—ã –ø–∏—à—É—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏ —Å fsync() –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

fsync, –∫—Å—Ç–∞—Ç–∏ - —ç—Ç–æ –µ—â—ë –æ–¥–Ω–∞ –æ—á–µ–Ω—å –≤–∞–∂–Ω–∞—è –≤–µ—â—å, –ø—Ä–æ –∫–æ—Ç–æ—Ä—É—é –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∑–∞–±—ã–≤–∞—é—Ç –≤ —Ç–µ—Å—Ç–∞—Ö.
–°–º—ã—Å–ª –≤ —Ç–æ–º, —á—Ç–æ –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏—Å–∫–∏ –∏–º–µ—é—Ç –∫—ç—à–∏/–±—É—Ñ–µ—Ä—ã –∑–∞–ø–∏—Å–∏ –∏ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ
–¥–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –Ω–æ—Å–∏—Ç–µ–ª—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –¥–µ–ª–∞–µ—Ç–µ fsync(),
–∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–º–∞–Ω–¥—É —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.

–î–µ—à—ë–≤—ã–µ SSD –¥–ª—è –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –ü–ö –∏ –Ω–æ—É—Ç–±—É–∫–æ–≤ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–µ –±–µ–∑ fsync - NVMe –¥–∏—Å–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä,
–º–æ–≥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Ä—è–¥–∫–∞ 80000 –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –≤ —Å–µ–∫—É–Ω–¥—É —Å –≥–ª—É–±–∏–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ 1 –±–µ–∑ fsync.
–û–¥–Ω–∞–∫–æ —Å fsync, –∫–æ–≥–¥–∞ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ –≤—ã–Ω—É–∂–¥–µ–Ω—ã –ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤–æ —Ñ–ª–µ—à-–ø–∞–º—è—Ç—å,
–æ–Ω–∏ –≤—ã–∂–∏–º–∞—é—Ç –ª–∏—à—å 1000-2000 –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –≤ —Å–µ–∫—É–Ω–¥—É (—á–∏—Å–ª–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ
–¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π SSD).

–°–µ—Ä–≤–µ—Ä–Ω—ã–µ SSD —á–∞—Å—Ç–æ –∏–º–µ—é—Ç —Å—É–ø–µ—Ä–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
–±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –∏ –¥–∞—é—â–∏–µ –¥–∏—Å–∫–∞–º —É—Å–ø–µ—Ç—å —Å–±—Ä–æ—Å–∏—Ç—å –∏—Ö DRAM-–∫—ç—à –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é
—Ñ–ª–µ—à-–ø–∞–º—è—Ç—å –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø–∏—Ç–∞–Ω–∏—è. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –¥–∏—Å–∫–∏ —Å —á–∏—Å—Ç–æ–π —Å–æ–≤–µ—Å—Ç—å—é
*–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç fsync*, —Ç–∞–∫ –∫–∞–∫ —Ç–æ—á–Ω–æ –∑–Ω–∞—é—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –¥–æ–µ–¥—É—Ç –¥–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π
–ø–∞–º—è—Ç–∏.

–í—Å–µ –Ω–∞–∏–±–æ–ª–µ–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –°–•–î, –Ω–∞–ø—Ä–∏–º–µ—Ä, Ceph –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –°–•–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
—Ç–∞–∫–∏–º–∏ –æ–±–ª–∞—á–Ω—ã–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏, –∫–∞–∫ Amazon, Google, –Ø–Ω–¥–µ–∫—Å, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –≤ —Å–º—ã—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏.
–í –ª—É—á—à–µ–º —Å–ª—É—á–∞–µ –æ–Ω–∏ –¥–∞—é—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –æ—Ç 0.3–º—Å –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ 0.6–º—Å –Ω–∞ –∑–∞–ø–∏—Å—å 4 –ö–ë –±–ª–æ–∫–∞–º–∏
–¥–∞–∂–µ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∂–µ–ª–µ–∑–∞.

–ò —ç—Ç–æ –≤ —ç–ø–æ—Ö—É SSD, –∫–æ–≥–¥–∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–π—Ç–∏ –Ω–∞ —Ä—ã–Ω–æ–∫ –∏ –∫—É–ø–∏—Ç—å —Ç–∞–º SSD, –∑–∞–¥–µ—Ä–∂–∫–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ
–Ω–∞ —á—Ç–µ–Ω–∏–µ –±—É–¥–µ—Ç 0.1–º—Å, –∞ –Ω–∞ –∑–∞–ø–∏—Å—å - 0.04–º—Å, –∑–∞ 100$ –∏–ª–∏ –¥–∞–∂–µ –¥–µ—à–µ–≤–ª–µ.

–ö–æ–≥–¥–∞ –º–Ω–µ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã, —è
–∏—Å–ø–æ–ª—å–∑—É—é —Å–ª–µ–¥—É—é—â–∏–µ 6 –∫–æ–º–∞–Ω–¥, —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏:

- –õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–ø–∏—Å—å:
  `fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4M -iodepth=32 -rw=write -runtime=60 -filename=/dev/sdX`
- –õ–∏–Ω–µ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:
  `fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4M -iodepth=32 -rw=read -runtime=60 -filename=/dev/sdX`
- –ó–∞–ø–∏—Å—å –≤ 1 –ø–æ—Ç–æ–∫ (T1Q1):
  `fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=1 -fsync=1 -rw=randwrite -runtime=60 -filename=/dev/sdX`
- –ß—Ç–µ–Ω–∏–µ –≤ 1 –ø–æ—Ç–æ–∫ (T1Q1):
  `fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=1 -rw=randread -runtime=60 -filename=/dev/sdX`
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å (numjobs –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ 1 —è–¥—Ä–æ CPU –Ω–µ –º–æ–∂–µ—Ç –Ω–∞—Å—ã—Ç–∏—Ç—å –¥–∏—Å–∫):
  `fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=128 [-numjobs=4 -group_reporting] -rw=randwrite -runtime=60 -filename=/dev/sdX`
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (numjobs - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ):
  `fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=128 [-numjobs=4 -group_reporting] -rw=randread -runtime=60 -filename=/dev/sdX`

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Vitastor

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:
- –ó–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è –≤ 1 –ø–æ—Ç–æ–∫ (T1Q1): 1 —Å–µ—Ç–µ–≤–æ–π RTT + 1 —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞.
- –ó–∞–ø–∏—Å—å+fsync –≤ 1 –ø–æ—Ç–æ–∫:
  - –° –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º —Å–±—Ä–æ—Å–æ–º: 2 RTT + 1 –∑–∞–ø–∏—Å—å.
  - –° –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º ("–ª–µ–Ω–∏–≤—ã–º") —Å–±—Ä–æ—Å–æ–º: 4 RTT + 1 –∑–∞–ø–∏—Å—å + 1 fsync.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: —Å—É–º–º–∞ IOPS –≤—Å–µ—Ö –¥–∏—Å–∫–æ–≤ –ª–∏–±–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏, –µ—Å–ª–∏ –≤ —Å–µ—Ç—å —É–ø—Ä—ë—Ç—Å—è —Ä–∞–Ω—å—à–µ.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å: —Å—É–º–º–∞ IOPS –≤—Å–µ—Ö –¥–∏—Å–∫–æ–≤ / —á–∏—Å–ª–æ —Ä–µ–ø–ª–∏–∫ / WA –ª–∏–±–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏, –µ—Å–ª–∏ –≤ —Å–µ—Ç—å —É–ø—Ä—ë—Ç—Å—è —Ä–∞–Ω—å—à–µ.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–¥–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –æ—à–∏–±–æ–∫ (EC):
- –ó–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è –≤ 1 –ø–æ—Ç–æ–∫ (T1Q1): 1.5 RTT + 1 —á—Ç–µ–Ω–∏–µ.
- –ó–∞–ø–∏—Å—å+fsync –≤ 1 –ø–æ—Ç–æ–∫:
  - –° –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º —Å–±—Ä–æ—Å–æ–º: 3.5 RTT + 1 —á—Ç–µ–Ω–∏–µ + 2 –∑–∞–ø–∏—Å–∏.
  - –° –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º ("–ª–µ–Ω–∏–≤—ã–º") —Å–±—Ä–æ—Å–æ–º: 5.5 RTT + 1 —á—Ç–µ–Ω–∏–µ + 2 –∑–∞–ø–∏—Å–∏ + 2 fsync.
- –ü–æ–¥ 0.5 –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è (k-1)/k, –≥–¥–µ k - —á–∏—Å–ª–æ –¥–∏—Å–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö,
  —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ —Å–µ—Ç–∏ –Ω–µ –Ω—É–∂–Ω–æ, –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è
  —á—Ç–µ–Ω–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: —Å—É–º–º–∞ IOPS –≤—Å–µ—Ö –¥–∏—Å–∫–æ–≤ –ª–∏–±–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏, –µ—Å–ª–∏ –≤ —Å–µ—Ç—å —É–ø—Ä—ë—Ç—Å—è —Ä–∞–Ω—å—à–µ.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å: —Å—É–º–º–∞ IOPS –≤—Å–µ—Ö –¥–∏—Å–∫–æ–≤ / –æ–±—â–µ–µ —á–∏—Å–ª–æ –¥–∏—Å–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ —á—ë—Ç–Ω–æ—Å—Ç–∏ / WA –ª–∏–±–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏, –µ—Å–ª–∏ –≤ —Å–µ—Ç—å —É–ø—Ä—ë—Ç—Å—è —Ä–∞–Ω—å—à–µ.
  –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: IOPS –¥–∏—Å–∫–æ–≤ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–∞–¥–æ –±—Ä–∞—Ç—å –≤ —Å–º–µ—à–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –≤ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π —Ñ–æ—Ä–º—É–ª–∞–º –≤—ã—à–µ.

WA (–º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏) –¥–ª—è 4 –ö–ë –±–ª–æ–∫–æ–≤ –≤ Vitastor –æ–±—ã—á–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 3-5:
1. –ó–∞–ø–∏—Å—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ –∂—É—Ä–Ω–∞–ª
2. –ó–∞–ø–∏—Å—å –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∂—É—Ä–Ω–∞–ª
3. –ó–∞–ø–∏—Å—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
4. –ï—â—ë –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ –∂—É—Ä–Ω–∞–ª –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ EC
5. –ó–∞–ø–∏—Å—å –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –≤—ã –Ω–∞–π–¥—ë—Ç–µ SSD, —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å 512-–±–∞–π—Ç–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (Optane?),
—Ç–æ 1, 3 –∏ 4 –º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 512 –±–∞–π—Ç (1/8 –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö) –∏ –ø–æ–ª—É—á–∏—Ç—å WA –≤—Å–µ–≥–æ 2.375.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, WA —Å–Ω–∏–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ/–ª–µ–Ω–∏–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π
–Ω–∞–≥—Ä—É–∑–∫–µ, —Ç.–∫. –±–ª–æ–∫–∏ –∂—É—Ä–Ω–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–ª–∏ —è–≤–Ω—ã–º
–æ–±—Ä–∞–∑–æ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è fsync.

## –ü—Ä–∏–º–µ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å Ceph

–ñ–µ–ª–µ–∑–æ - 4 —Å–µ—Ä–≤–µ—Ä–∞, –≤ –∫–∞–∂–¥–æ–º:
- 6x SATA SSD Intel D3-4510 3.84 TB
- 2x Xeon Gold 6242 (16 cores @ 2.8 GHz)
- 384 GB RAM
- 1x 25 GbE —Å–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ (Mellanox ConnectX-4 LX), –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–∞—è –∫ —Å–≤–∏—Ç—á—É Juniper QFX5200

–≠–∫–æ–Ω–æ–º–∏—è —ç–Ω–µ—Ä–≥–∏–∏ CPU –æ—Ç–∫–ª—é—á–µ–Ω–∞. –í —Ç–µ—Å—Ç–∞—Ö –∏ Vitastor, –∏ Ceph —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –ø–æ 2 OSD –Ω–∞ 1 SSD.

–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Å–ª—É—á–∞–π–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ 4 –ö–ë –±–ª–æ–∫–∞–º–∏ (–µ—Å–ª–∏ —è–≤–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–µ).

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–æ–ª—ã—Ö –¥–∏—Å–∫–æ–≤:
- T1Q1 –∑–∞–ø–∏—Å—å ~27000 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.037ms)
- T1Q1 —á—Ç–µ–Ω–∏–µ ~9800 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.101ms)
- T1Q32 –∑–∞–ø–∏—Å—å ~60000 iops
- T1Q32 —á—Ç–µ–Ω–∏–µ ~81700 iops

Ceph 15.2.4 (Bluestore):
- T1Q1 –∑–∞–ø–∏—Å—å ~1000 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~1ms)
- T1Q1 —á—Ç–µ–Ω–∏–µ ~1750 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.57ms)
- T8Q64 –∑–∞–ø–∏—Å—å ~100000 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ OSD –æ–∫–æ–ª–æ 40 —è–¥–µ—Ä –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- T8Q64 —á—Ç–µ–Ω–∏–µ ~480000 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ OSD –æ–∫–æ–ª–æ 40 —è–¥–µ—Ä –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ

–¢–µ—Å—Ç—ã –≤ 8 –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å –Ω–∞ 8 400GB RBD –æ–±—Ä–∞–∑–∞—Ö —Å–æ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤ (—Å –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å 2 –ø—Ä–æ—Ü–µ—Å—Å–∞ fio).
–≠—Ç–æ –Ω—É–∂–Ω–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤ Ceph –Ω–µ—Å–∫–æ–ª—å–∫–æ RBD-–∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–∏—à—É—â–∏—Ö –≤ 1 –æ–±—Ä–∞–∑, –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –∑–∞–º–µ–¥–ª—è—é—Ç—Å—è.

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ RocksDB –∏ Bluestore –≤ Ceph –Ω–µ –º–µ–Ω—è–ª–∏—Å—å, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –±—ã–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ cephx_sign_messages.

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –Ω–µ —Ç–∞–∫–∏–µ —É–∂ –∏ –ø–ª–æ—Ö–∏–µ –¥–ª—è Ceph (–º–æ–≥–ª–æ –±—ã—Ç—å —Ö—É–∂–µ).
–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –≥–æ–≤–æ—Ä—è, —ç—Ç–∏ —Å–µ—Ä–≤–µ—Ä—ã –∫–∞–∫ —Ä–∞–∑ —Ö–æ—Ä–æ—à–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è Ceph - 6 SATA SSD –∫–∞–∫ —Ä–∞–∑
—É—Ç–∏–ª–∏–∑–∏—Ä—É—é—Ç 25-–≥–∏–≥–∞–±–∏—Ç–Ω—É—é —Å–µ—Ç—å, –∞ –±–µ–∑ 2 –º–æ—â–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ Ceph-—É –±—ã –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ —è–¥–µ—Ä,
—á—Ç–æ–±—ã –≤—ã–¥–∞—Ç—å –ø—Ä–∏—Å—Ç–æ–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, —á—Ç–æ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∂–æ—Ä 40 —è–¥–µ—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞.

Vitastor:
- T1Q1 –∑–∞–ø–∏—Å—å: 7087 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ 0.14ms)
- T1Q1 —á—Ç–µ–Ω–∏–µ: 6838 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ 0.145ms)
- T2Q64 –∑–∞–ø–∏—Å—å: 162000 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU - 3 —è–¥—Ä–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- T8Q64 —á—Ç–µ–Ω–∏–µ: 895000 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU - 4 —è–¥—Ä–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- –õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–ø–∏—Å—å (4M T1Q32): 2800 –ú–ë/—Å
- –õ–∏–Ω–µ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (4M T1Q32): 1500 –ú–ë/—Å

–¢–µ—Å—Ç –Ω–∞ —á—Ç–µ–Ω–∏–µ –≤ 8 –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–æ–≤–æ–¥–∏–ª—Å—è –Ω–∞ 1 –±–æ–ª—å—à–æ–º –æ–±—Ä–∞–∑–µ (3.2 –¢–ë) —Å–æ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤ (–æ–ø—è—Ç—å –∂–µ, –ø–æ 2 fio —Å –∫–∞–∂–¥–æ–≥–æ).
–í Vitastor –Ω–∏–∫–∞–∫–æ–π —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É 1 –æ–±—Ä–∞–∑–æ–º –∏ 8-—é –Ω–µ—Ç. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –ø—Ä–∏–º–µ—Ä–Ω–æ 1/4 –∑–∞–ø—Ä–æ—Å–æ–≤ —á—Ç–µ–Ω–∏—è
–≤ —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–∞–∫ –∏ –≤ —Ç–µ—Å—Ç–∞—Ö Ceph –≤—ã—à–µ, –æ–±—Å–ª—É–∂–∏–≤–∞–ª–∞—Å—å —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –ï—Å–ª–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å
—Ç–µ—Å—Ç —Ç–∞–∫, —á—Ç–æ–±—ã –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞—â–∞–ª–∏—Å—å –∫ –ø–µ—Ä–≤–∏—á–Ω—ã–º OSD –ø–æ —Å–µ—Ç–∏ - —Ç–µ—Å—Ç —Å–∏–ª—å–Ω–µ–µ —É–ø–∏—Ä–∞–ª—Å—è
–≤ —Å–µ—Ç—å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Å—Ç–∞–≤–ª—è–ª –ø—Ä–∏–º–µ—Ä–Ω–æ 689000 iops.

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Vitastor: `--disable_data_fsync true --immediate_commit all --flusher_count 8
  --disk_alignment 4096 --journal_block_size 4096 --meta_block_size 4096
  --journal_no_same_sector_overwrites true --journal_sector_buffer_count 1024
  --journal_size 16777216`.

### EC/XOR 2+1

Vitastor:
- T1Q1 –∑–∞–ø–∏—Å—å: 2808 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.355ms)
- T1Q1 —á—Ç–µ–Ω–∏–µ: 6190 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.16ms)
- T2Q64 –∑–∞–ø–∏—Å—å: 85500 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU - 3.4 —è–¥—Ä–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- T8Q64 —á—Ç–µ–Ω–∏–µ: 812000 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU - 4.7 —è–¥—Ä–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- –õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–ø–∏—Å—å (4M T1Q32): 3200 –ú–ë/—Å
- –õ–∏–Ω–µ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (4M T1Q32): 1800 –ú–ë/—Å

Ceph:
- T1Q1 –∑–∞–ø–∏—Å—å: 730 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ ~1.37ms latency)
- T1Q1 —á—Ç–µ–Ω–∏–µ: 1500 iops —Å —Ö–æ–ª–æ–¥–Ω—ã–º –∫—ç—à–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.66ms), 2300 iops —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –ø—Ä–æ–≥—Ä–µ–≤–∞ (–∑–∞–¥–µ—Ä–∂–∫–∞ ~0.435ms)
- T4Q128 –∑–∞–ø–∏—Å—å (4 RBD images): 45300 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU - 30 —è–¥–µ—Ä –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- T8Q64 —á—Ç–µ–Ω–∏–µ (4 RBD images): 278600 iops, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU - 40 —è–¥–µ—Ä –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- –õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–ø–∏—Å—å (4M T1Q32): 1950 –ú–ë/—Å –≤ –ø—É—Å—Ç–æ–π –æ–±—Ä–∞–∑, 2500 –ú–ë/—Å –≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –æ–±—Ä–∞–∑
- –õ–∏–Ω–µ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (4M T1Q32): 2400 –ú–ë/—Å

### NBD

NBD - –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Vitastor —è–¥—Ä–æ–º Linux, –Ω–æ –æ–Ω
–ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è–º –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –Ω–µ–º–Ω–æ–≥–æ —É—Ö—É–¥—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å,
–ø—Ä–∞–≤–¥–∞, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º - –ª–∏–Ω–µ–π–Ω—É—é, –∞ —Å–ª—É—á–∞–π–Ω–∞—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç—Å—è —Å–ª–∞–±–æ.

NBD —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "—Å–µ—Ç–µ–≤–æ–µ –±–ª–æ—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–Ω–æ —Ç–∞–∫–∂–µ
—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ –∫–∞–∫ –∞–Ω–∞–ª–æ–≥ FUSE –¥–ª—è –±–ª–æ—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Ç–æ –µ—Å—Ç—å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π
"–±–ª–æ—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è".

Vitastor —Å –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–π NBD –ø—Ä–æ–∫—Å–∏ –Ω–∞ —Ç–æ–º –∂–µ —Å—Ç–µ–Ω–¥–µ:
- T1Q1 –∑–∞–ø–∏—Å—å: 6000 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ 0.166ms)
- T1Q1 —á—Ç–µ–Ω–∏–µ: 5518 iops (–∑–∞–¥–µ—Ä–∂–∫–∞ 0.18ms)
- T1Q128 –∑–∞–ø–∏—Å—å: 94400 iops
- T1Q128 —á—Ç–µ–Ω–∏–µ: 103000 iops
- –õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–ø–∏—Å—å (4M T1Q128): 1266 –ú–ë/—Å (–≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å 2800 –ú–ë/—Å —á–µ—Ä–µ–∑ fio)
- –õ–∏–Ω–µ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (4M T1Q128): 975 –ú–ë/—Å (–≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å 1500 –ú–ë/—Å —á–µ—Ä–µ–∑ fio)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### Debian

- –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Vitastor:
  `wget -q -O - https://vitastor.io/debian/pubkey | sudo apt-key add -`
- –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Vitastor –≤ /etc/apt/sources.list:
  - Debian 11 (Bullseye/Sid): `deb https://vitastor.io/debian bullseye main`
  - Debian 10 (Buster): `deb https://vitastor.io/debian buster main`
- –î–ª—è Debian 10 (Buster) —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π backports:
  `deb http://deb.debian.org/debian buster-backports main`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã: `apt update; apt install vitastor lp-solve etcd linux-image-amd64 qemu`

### CentOS

- –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Vitastor:
  - CentOS 7: `yum install https://vitastor.io/rpms/centos/7/vitastor-release-1.0-1.el7.noarch.rpm`
  - CentOS 8: `dnf install https://vitastor.io/rpms/centos/8/vitastor-release-1.0-1.el8.noarch.rpm`
- –í–∫–ª—é—á–∏—Ç–µ EPEL: `yum/dnf install epel-release`
- –í–∫–ª—é—á–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ CentOS:
  - CentOS 7: `yum install centos-release-scl`
  - CentOS 8: `dnf install centos-release-advanced-virtualization`
- –í–∫–ª—é—á–∏—Ç–µ elrepo-kernel:
  - CentOS 7: `yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm`
  - CentOS 8: `dnf install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã: `yum/dnf install vitastor lpsolve etcd kernel-ml qemu-kvm`

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —è–¥—Ä–æ 5.4 –∏–ª–∏ –±–æ–ª–µ–µ –Ω–æ–≤–æ–µ, –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ io_uring. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ 5.8 –∏–ª–∏ –¥–∞–∂–µ –Ω–æ–≤–µ–µ,
  —Ç–∞–∫ –∫–∞–∫ –≤ 5.4 –µ—Å—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 1 –∏–∑–≤–µ—Å—Ç–Ω—ã–π –±–∞–≥, –≤–µ–¥—É—â–∏–π –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é —Å io_uring –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º HP SmartArray.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ liburing 0.4 –∏–ª–∏ –±–æ–ª–µ–µ –Ω–æ–≤—ã–π –∏ –µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ lp_solve.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ etcd. –í–Ω–∏–º–∞–Ω–∏–µ: –≤–∞–º –Ω—É–∂–Ω–∞ –≤–µ—Ä—Å–∏—è —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –æ—Ç—Å—é–¥–∞: https://github.com/vitalif/etcd/,
  –∏–∑ –≤–µ—Ç–∫–∏ release-3.4, —Ç–∞–∫ –∫–∞–∫ –≤ etcd –µ—Å—Ç—å –±–∞–≥, –∫–æ—Ç–æ—Ä—ã–π [–±—É–¥–µ—Ç](https://github.com/etcd-io/etcd/pull/12402)
  –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –≤ 3.4.15. –ë–∞–≥ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Vitastor –∑–∞–ø—É—Å—Ç–∏—Ç—å PG, –∫–æ–≥–¥–∞ –∏—Ö —Ö–æ—Ç—è –±—ã 500 —à—Ç—É–∫.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ node.js 10 –∏–ª–∏ –Ω–æ–≤–µ–µ.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ gcc –∏ g++ 8.x –∏–ª–∏ –Ω–æ–≤–µ–µ.
- –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –ø–æ–¥–º–æ–¥—É–ª—è–º–∏: `git clone https://yourcmc.ru/git/vitalif/vitastor/`.
- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å QEMU —Å –ø–∞—Ç—á–µ–º, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ LD_PRELOAD.
  –°–º `qemu-*.*-vitastor.patch` - –≤—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é, –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫—É—é –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ QEMU.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ QEMU 3.0 –∏–ª–∏ –Ω–æ–≤–µ–µ, –≤–æ–∑—å–º–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–¥—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ –µ–≥–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É,
  —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ—ë –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
   - `<qemu>/include` &rarr; `<vitastor>/qemu/include`
   - Debian:
      * –ë–µ—Ä–∏—Ç–µ qemu –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      * `<qemu>/b/qemu/config-host.h` &rarr; `<vitastor>/qemu/b/qemu/config-host.h`
      * `<qemu>/b/qemu/qapi` &rarr; `<vitastor>/qemu/b/qemu/qapi`
   - CentOS 8:
      * –ë–µ—Ä–∏—Ç–µ qemu –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Advanced-Virtualization. –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –µ–≥–æ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
        `yum install centos-release-advanced-virtualization.noarch` –∏ –¥–∞–ª–µ–µ `yum install qemu`
      * `<qemu>/config-host.h` &rarr; `<vitastor>/qemu/b/qemu/config-host.h`
      * –î–ª—è QEMU 3.0+: `<qemu>/qapi` &rarr; `<vitastor>/qemu/b/qemu/qapi`
      * –î–ª—è QEMU 2.0+: `<qemu>/qapi-types.h` &rarr; `<vitastor>/qemu/b/qemu/qapi-types.h`
   - `config-host.h` –∏ `qapi` –Ω—É–∂–Ω—ã, —Ç.–∫. –≤ –Ω–∏—Ö —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ fio 3.7 –∏–ª–∏ –Ω–æ–≤–µ–µ, –≤–æ–∑—å–º–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –ø–∞–∫–µ—Ç–∞ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –Ω–∞ –Ω–∏—Ö —Å–∏–º–ª–∏–Ω–∫ —Å `<vitastor>/fio`.
- –°–æ–±–µ—Ä–∏—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Vitastor –∫–æ–º–∞–Ω–¥–æ–π `mkdir build && cd build && cmake .. && make -j8 && make install`.
  –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é cmake `QEMU_PLUGINDIR` - –ø–æ–¥ RHEL –µ—ë –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–≤–Ω–æ–π `qemu-kvm`.

## –ó–∞–ø—É—Å–∫

–í–Ω–∏–º–∞–Ω–∏–µ: –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–∫–∞ —á—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è, –∑–∞–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ —Å–º–µ—â–µ–Ω–∏—è
–Ω–∞ –¥–∏—Å–∫–µ –Ω—É–∂–Ω–æ –ø–æ—á—Ç–∏ –≤—Ä—É—á–Ω—É—é. –≠—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–ª–∏–∂–∞–π—à–µ–º –±—É–¥—É—â–µ–º.

- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã SATA SSD –∏–ª–∏ NVMe –¥–∏—Å–∫–∏ —Å –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞–º–∏ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–µ SSD). –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏
  –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ SSD, –≤–∫–ª—é—á–∏–≤ —Ä–µ–∂–∏–º –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ fsync, –Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–π –∑–∞–ø–∏—Å–∏
  –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–µ—Ç.
- –ë—ã—Å—Ç—Ä–∞—è —Å–µ—Ç—å, –º–∏–Ω–∏–º—É–º 10 –≥–±–∏—Ç/—Å
- –î–ª—è –Ω–∞–∏–ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ CPU: `cpupower idle-set -D 0 && cpupower frequency-set -g performance`.
- –ü—Ä–æ–ø–∏—à–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –≤–∞–º –∑–Ω–∞—á–µ–Ω–∏—è –≤–≤–µ—Ä—Ö—É —Ñ–∞–π–ª–æ–≤ `/usr/lib/vitastor/mon/make-units.sh` –∏ `/usr/lib/vitastor/mon/make-osd.sh`.
- –°–æ–∑–¥–∞–π—Ç–µ —é–Ω–∏—Ç—ã systemd –¥–ª—è etcd –∏ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤: `/usr/lib/vitastor/mon/make-units.sh`
- –°–æ–∑–¥–∞–π—Ç–µ —é–Ω–∏—Ç—ã –¥–ª—è OSD: `/usr/lib/vitastor/mon/make-osd.sh /dev/disk/by-partuuid/XXX [/dev/disk/by-partuuid/YYY ...]`
- –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã OSD –≤ —é–Ω–∏—Ç–∞—Ö systemd. –°–º—ã—Å–ª –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
  - `disable_data_fsync 1` - –æ—Ç–∫–ª—é—á–∞–µ—Ç fsync, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å SSD —Å –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞–º–∏.
  - `immediate_commit all` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å SSD —Å –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞–º–∏.
  - `disable_device_lock 1` - –æ—Ç–∫–ª—é—á–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –Ω—É–∂–Ω–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ
    –Ω–µ—Å–∫–æ–ª—å–∫–æ OSD –Ω–∞ –æ–¥–Ω–æ–º –±–ª–æ—á–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
  - `flusher_count 256` - "flusher" - –º–∏–∫—Ä–æ–ø–æ—Ç–æ–∫, —É–¥–∞–ª—è—é—â–∏–π —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∂—É—Ä–Ω–∞–ª–∞.
    –ù–µ –≤–æ–ª–Ω—É–π—Ç–µ—Å—å –æ–± —ç—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, 256 —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–≥–¥–∞.
  - `disk_alignment`, `journal_block_size`, `meta_block_size` —Å–ª–µ–¥—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–≤–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä—É
    –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –±–ª–æ–∫–∞ SSD. –≠—Ç–æ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ 4096.
  - `journal_no_same_sector_overwrites true` –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —Å–µ–∫—Ç–æ—Ä–∞ –∂—É—Ä–Ω–∞–ª–∞ –ø–æ–¥—Ä—è–¥
    –º–Ω–æ–≥–æ —Ä–∞–∑ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–ø–∏—Å–∏. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (99%) SSD –Ω–µ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –¥–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏. –û–¥–Ω–∞–∫–æ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ
    –¥–∏—Å–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç–µ–Ω–¥–æ–≤ - Intel D3-S4510 - –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –Ω–µ –ª—é–±—è—Ç —Ç–∞–∫—É—é
    –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å, –∏ –¥–ª—è –Ω–∏—Ö –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —ç—Ç–∞ –æ–ø—Ü–∏—è. –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á—ë–Ω, —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å
    –∑–Ω–∞—á–µ–Ω–∏–µ `journal_sector_buffer_count`, —Ç–∞–∫ –∫–∞–∫ –∏–Ω–∞—á–µ Vitastor –Ω–µ —Ö–≤–∞—Ç–∏—Ç –±—É—Ñ–µ—Ä–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª.
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ etcd: `systemctl start etcd`
- –°–æ–∑–¥–∞–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ etcd: `etcdctl --endpoints=... put /vitastor/config/global '{"immediate_commit":"all"}'`
  (–µ—Å–ª–∏ –≤—Å–µ –≤–∞—à–∏ –¥–∏—Å–∫–∏ - —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Å –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞–º–∏).
- –°–æ–∑–¥–∞–π—Ç–µ –ø—É–ª—ã: `etcdctl --endpoints=... put /vitastor/config/pools '{"1":{"name":"testpool","scheme":"replicated","pg_size":2,"pg_minsize":1,"pg_count":256,"failure_domain":"host"}}'`.
  –î–ª—è jerasure EC-–ø—É–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫: `2:{"name":"ecpool","scheme":"jerasure","pg_size":4,"parity_chunks":2,"pg_minsize":2,"pg_count":256,"failure_domain":"host"}`.
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ OSD: `systemctl start vitastor.target`
- –í–∞—à –∫–ª–∞—Å—Ç–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ - –æ–¥–∏–Ω –∏–∑ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω —É–∂–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å PG, –∞ OSD –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏—Ö.
- –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ PG –ø—Ä—è–º–æ –≤ etcd: `etcdctl --endpoints=... get --prefix /vitastor/pg/state`. –í—Å–µ PG –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 'active'.
- –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤: `fio -thread -ioengine=libfio_vitastor.so -name=test -bs=4M -direct=1 -iodepth=16 -rw=write -etcd=10.115.0.10:2379/v3 -pool=1 -inode=1 -size=400G`.
- –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ª–∏–≤–∫–∏ –æ–±—Ä–∞–∑–∞ –í–ú –≤ vitastor —á–µ—Ä–µ–∑ qemu-img:
  ```
  qemu-img convert -f qcow2 debian10.qcow2 -p -O raw 'vitastor:etcd_host=10.115.0.10\:2379/v3:pool=1:inode=1:size=2147483648'
  ```
  –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–µ–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π QEMU, –¥–∞–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `LD_PRELOAD=/usr/lib/x86_64-linux-gnu/qemu/block-vitastor.so`.
- –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ QEMU:
  ```
  qemu-system-x86_64 -enable-kvm -m 1024
    -drive 'file=vitastor:etcd_host=10.115.0.10\:2379/v3:pool=1:inode=1:size=2147483648',format=raw,if=none,id=drive-virtio-disk0,cache=none
    -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x5,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1,write-cache=off,physical_block_size=4096,logical_block_size=512
    -vnc 0.0.0.0:0
  ```
- –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã —É–¥–∞–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–∞ (–∏–Ω–æ–¥–∞) –∏–∑ Vitastor:
  ```
  vitastor-rm --etcd_address 10.115.0.10:2379/v3 --pool 1 --inode 1 --parallel_osds 16 --iodepth 32
  ```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ó–∞–ø—Ä–æ—Å—ã —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–≥—É—Ç –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ "–Ω–µ–ø–æ–ª–Ω—ã–º" –æ–±—ä–µ–∫—Ç–∞–º –≤ EC-–ø—É–ª–∞—Ö,
  –µ—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ–π–¥—É—Ç –æ—Ç–∫–∞–∑—ã OSD –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
  –∑–∞–ø—Ä–æ—Å–æ–≤ —É–¥–∞–ª–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "—Ç—Ä—ë—Ö—Ñ–∞–∑–Ω–æ–π", –∞ —ç—Ç–æ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. –ï—Å–ª–∏ –≤—ã
  —Å—Ç–æ–ª–∫–Ω—ë—Ç–µ—Å—å —Å —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π, –ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å —É–¥–∞–ª–µ–Ω–∏—è.

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –Ø –ª—é–±–ª—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–æ—Å—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è. Vitastor –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Ç–∞–∫ –∏ —è –Ω–∞–º–µ—Ä–µ–Ω
  –∏ –¥–∞–ª–µ–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å –¥–∞–Ω–Ω–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É.
- –ï—Å–ª–∏ –≤—ã –ø—Ä–∏—à–ª–∏ —Å—é–¥–∞ –∑–∞ –∏–¥–µ–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º –Ω–∞ C++, –≤—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–µ –ø–æ –∞–¥—Ä–µ—Å—É. "–û–±—â–µ–ø—Ä–∏–Ω—è—Ç—ã–µ"
  –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è C++ –∫–æ–¥–∞ –º–µ–Ω—è –Ω–µ –æ—á–µ–Ω—å –≤–æ–ª–Ω—É—é—Ç, —Ç–∞–∫ –∫–∞–∫ –∑–∞—á–∞—Å—Ç—É—é, –æ–ø—è—Ç—å-—Ç–∞–∫–∏, –≤–µ–¥—É—Ç –∫
  –∏–∑–ª–∏—à–Ω–∏–º —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è–º –∏ –∫–æ–¥ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∫—Ä–∞—Å–∏–≤—ã–π... –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π.
- –ü–æ —Ç–æ–π –∂–µ –ø—Ä–∏—á–∏–Ω–µ –≤ –∫–æ–¥–µ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã —Ç–∏–ø–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ
  HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å etcd. –ó–∞—Ç–æ —ç—Ç–∏ –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç
  –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–µ—Å—è—Ç–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.
- node.js –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∞ - –Ω–µ —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä. –û–Ω –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π, –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–æ–±—ã—Ç–∏–π–Ω—É—é
  –º–∞—à–∏–Ω—É, –ø—Ä–∏—è—Ç–Ω—ã–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π C-–ø–æ–¥–æ–±–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–∏—Ç—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

## –ê–≤—Ç–æ—Ä –∏ –ª–∏—Ü–µ–Ω–∑–∏—è

–ê–≤—Ç–æ—Ä: –í–∏—Ç–∞–ª–∏–π –§–∏–ª–∏–ø–ø–æ–≤ (vitalif [at] yourcmc.ru), 2019+

–ó–∞—Ö–æ–¥–∏—Ç–µ –≤ Telegram-—á–∞—Ç Vitastor: https://t.me/vitastor

–õ–∏—Ü–µ–Ω–∑–∏—è: VNPL 1.1 –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –∏ –¥–≤–æ–π–Ω–∞—è VNPL 1.1 + GPL 2.0+ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π.

VNPL - "—Å–µ—Ç–µ–≤–æ–π –∫–æ–ø–∏–ª–µ—Ñ—Ç", —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–≤–æ–±–æ–¥–Ω–∞—è –∫–æ–ø–∏–ª–µ—Ñ—Ç-–ª–∏—Ü–µ–Ω–∑–∏—è
Vitastor Network Public License 1.1, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ GNU GPL 3.0 —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º
—É—Å–ª–æ–≤–∏–µ–º "–°–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è", —Ç—Ä–µ–±—É—é—â–∏–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã,
—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–º–µ—Å—Ç–µ —Å Vitastor –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–µ
—Å –Ω–∏–º –ø–æ —Å–µ—Ç–∏, –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π VNPL –∏–ª–∏ –ø–æ–¥ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Å–≤–æ–±–æ–¥–Ω–æ–π –ª–∏—Ü–µ–Ω–∑–∏–µ–π.

–ò–¥–µ—è VNPL - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–ø–∏–ª–µ—Ñ—Ç–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–¥—É–ª–∏, —è–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
—Å–≤—è–∑—ã–≤–∞–µ–º—ã–µ —Å –∫–æ–¥–æ–º Vitastor, –Ω–æ —Ç–∞–∫–∂–µ –Ω–∞ –º–æ–¥—É–ª–∏, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–µ —Å –Ω–∏–º –ø–æ —Å–µ—Ç–∏.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ Vitastor —Å–µ—Ä–≤–∏—Å, —Å–æ–¥–µ—Ä–∂–∞—à–∏–π
–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –∑–∞–∫—Ä—ã—Ç—ã–º –∫–æ–¥–æ–º, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏–µ —Å Vitastor, –≤–∞–º –Ω—É–∂–Ω–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è
–ª–∏—Ü–µ–Ω–∑–∏—è –æ—Ç –∞–≤—Ç–æ—Ä–∞ üòÄ.

–ù–∞ Windows –∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –ü–û, –Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ *—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ* –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–≤–º–µ—Å—Ç–µ —Å Vitastor, –Ω–∏–∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è.

–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö –¥–≤–æ–π–Ω–æ–π –ª–∏—Ü–µ–Ω–∑–∏–∏ VNPL 1.0
–∏ —Ç–∞–∫–∂–µ –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö GNU GPL 2.0 –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏. –¢–∞–∫ —Å–¥–µ–ª–∞–Ω–æ –≤ —Ü–µ–ª—è—Ö
—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ç–∞–∫–∏–º –ü–û, –∫–∞–∫ QEMU –∏ fio.

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç VNPL 1.1 –≤ —Ñ–∞–π–ª–µ [VNPL-1.1.txt](VNPL-1.1.txt),
–∞ GPL 2.0 –≤ —Ñ–∞–π–ª–µ [GPL-2.0.txt](GPL-2.0.txt).
