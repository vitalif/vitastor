[–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../../README-ru.md#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) ‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ‚Üí VitastorFS –∏ –ø—Å–µ–≤–¥–æ-–§–°

-----

[Read in English](nfs.en.md)

# VitastorFS –∏ –ø—Å–µ–≤–¥–æ-–§–°

–í Vitastor –µ—Å—Ç—å –¥–≤–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. –û–±–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `vitastor-nfs`.

–ö–æ–º–∞–Ω–¥—ã:
- [mount](#mount)
- [start](#start)
- [upgrade](#upgrade)
- [defrag](#defrag)

‚ö†Ô∏è –í–∞–∂–Ω–æ: –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Vitastor NFS –≤ Linux –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
HDD –∏ EC (erasure –∫–æ–¥–æ–≤) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ [–†–∞–∑–º–µ—Ä –∑–∞–ø–∏—Å–∏ Linux NFS](#—Ä–∞–∑–º–µ—Ä-–∑–∞–ø–∏—Å–∏-linux-nfs).

## –ü—Å–µ–≤–¥–æ-–§–°

–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Å–µ–≤–¥–æ-–§–° –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–ª–æ—á–Ω—ã–º
–æ–±—Ä–∞–∑–∞–º Vitastor. –≠—Ç–æ –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ - –≤ –Ω–µ–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
POSIX –§–°, –∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ (–æ–±—Ä–∞–∑–æ–≤) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ etcd –∏ –≤—Å—ë –≤—Ä–µ–º—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤
–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ - —Ç–æ –µ—Å—Ç—å, –ø—Å–µ–≤–¥–æ-–§–° –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ—Ç–µ–Ω –∏–ª–∏ —Ç—ã—Å—è—á —Ñ–∞–π–ª–æ–≤, –Ω–æ –Ω–µ –º–∏–ª–ª–∏–æ–Ω–æ–≤.

–ü—Å–µ–≤–¥–æ-–§–° –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—Ä–∞–∑–∞–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –≤ —Å—Ä–µ–¥–∞—Ö, –≥–¥–µ –¥—Ä—É–≥–∏–µ
—Å–ø–æ—Å–æ–±—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã –∏–ª–∏ –Ω–µ—É–¥–æ–±–Ω—ã - –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ VMWare. –î–ª—è VMWare —ç—Ç–æ –ª—É—á—à–∞—è –æ–ø—Ü–∏—è, —á–µ–º
iSCSI, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ iSCSI VMWare —Ä–∞–∑–º–µ—â–∞–µ—Ç –≤—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –≤ –æ–¥–Ω–æ–º
–±–æ–ª—å—à–æ–º –±–ª–æ—á–Ω–æ–º –æ–±—Ä–∞–∑–µ –≤–Ω—É—Ç—Ä–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –§–° VMFS, –∞ —Å NFS VMFS –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –∫–∞–∂–¥—ã–π
–¥–∏—Å–∫ –í–ú –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –≤–∏–¥–µ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, —Ç–æ –µ—Å—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–Ω–æ–º—É –±–ª–æ—á–Ω–æ–º—É –æ–±—Ä–∞–∑—É
Vitastor, –∫–∞–∫ —ç—Ç–æ –∏ –∑–∞–¥—É–º–∞–Ω–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ.

–ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ø—Å–µ–≤–¥–æ-–§–° Vitastor, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `vitastor-nfs mount --block /mnt/vita`.

–õ–∏–±–æ –∂–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ç–µ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–µ—Ä–≤–µ—Ä–∞:

```
vitastor-nfs start --block --etcd_address 192.168.5.10:2379 --portmap 0 --port 2050 --pool testpool
```

–ü—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –§–°, –∑–∞–ø—É—â–µ–Ω–Ω—É—é —Å —Ç–∞–∫–∏–º–∏ –æ–ø—Ü–∏—è–º–∏, –º–æ–∂–Ω–æ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:

```
mount server:/ /mnt/ -o port=2050,mountport=2050,nfsvers=3,soft,nolock,tcp
```

## VitastorFS

VitastorFS - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–Ω–∞—è (Read-Write-Many) —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞. –û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
–±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π POSIX - –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏, –∂—ë—Å—Ç–∫–∏–µ
—Å—Å—ã–ª–∫–∏, –±—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ VitastorFS —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î —Ñ–æ—Ä–º–∞—Ç–∞ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏—è,
–æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–º –ë-–¥–µ—Ä–µ–≤–µ –ø–æ–≤–µ—Ä—Ö –æ–±—ã—á–Ω–æ–≥–æ –±–ª–æ—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ Vitastor.
–ò –∑–∞–ø–∏—Å–∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤, –∏ –∏–Ω–æ–¥—ã, –∫–∞–∫ –æ–±—ã—á–Ω–æ –≤ Vitastor, —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø—Ä–æ—Å—Ç–æ–º —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–º
JSON-—Ñ–æ—Ä–º–∞—Ç–µ :-). –î–ª—è –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `vitastor-kv`.

–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VitastorFS:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—É–ª –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –§–° –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—É—Å—Ç–æ–π –ø—É–ª
2. –°–æ–∑–¥–∞–π—Ç–µ –±–ª–æ—á–Ω—ã–π –æ–±—Ä–∞–∑ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –§–°, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –≤ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–º –ø—É–ª–µ (–Ω–∞ SSD
   –∏–ª–∏ –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –Ω–∞ HDD, –Ω–æ –±–µ–∑ EC), –Ω–æ –º–æ–∂–Ω–æ –∏ –≤ —Ç–æ–º –∂–µ –ø—É–ª–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ
   (—Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç):
   `vitastor-cli create -s 10G -p fastpool testfs`
3. –ü–æ–º–µ—Ç—å—Ç–µ –ø—É–ª –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –§–°-–ø—É–ª: `vitastor-cli modify-pool --used-for-app fs:testfs data-pool`
4. –õ–∏–±–æ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –§–°: `vitastor-nfs mount --fs testfs --pool data-pool /mnt/vita`
5. –õ–∏–±–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ç–µ–≤–æ–π NFS-—Å–µ—Ä–≤–µ—Ä: `vitastor-nfs start --fs testfs --pool data-pool`

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ POSIX

- –ß—Ç–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å
- –ó–∞–ø–∏—Å—å –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (truncate)
- –ü—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã (chmod/chown)
- –§–∏–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–∏ (–∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ) (fsync)
- –°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏
- –ñ—ë—Å—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Å–æ–∫–µ—Ç—ã, –∫–∞–Ω–∞–ª—ã)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º—ë–Ω –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ (mtime), –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (ctime)
- –†—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º—ë–Ω –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ (mtime), –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (atime)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤–æ –≤—Ä–µ–º—è –ª–∏—Å—Ç–∏–Ω–≥–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ VitastorFS —Ñ—É–Ω–∫—Ü–∏–∏ POSIX:
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–Ω—è—Ç–æ–µ —Ñ–∞–π–ª–∞–º–∏ –º–µ—Å—Ç–æ –Ω–µ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤—ã–∑–æ–≤–∞–º–∏
  stat(2), —Ç–∞–∫ —á—Ç–æ `du` –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤, –∞ –Ω–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–Ω—è—Ç–æ–µ –º–µ—Å—Ç–æ
- –í—Ä–µ–º–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ (`atime`) –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è (–∫–∞–∫ –±—É–¥—Ç–æ –§–° —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å `-o noatime`)
- –í—Ä–µ–º–µ–Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`mtime`) –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–∫–∞–∫ –±—É–¥—Ç–æ –§–° —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å `-o lazytime`)

–î—Ä—É–≥–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º:
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –∏–Ω–æ–¥–æ–≤. –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ –∏–Ω–æ–¥–æ–≤ –≤—Å—ë –≤—Ä–µ–º—è
  —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è, —Ç–∞–∫ —á—Ç–æ –≤ —Ç–µ–æ—Ä–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç, –µ—Å–ª–∏ –Ω–∞—Å–æ–∑–¥–∞—ë—Ç–µ
  –∏ –Ω–∞—É–¥–∞–ª—è–µ—Ç–µ –±–æ–ª—å—à–µ, —á–µ–º 2^48 —Ñ–∞–π–ª–æ–≤.
- –û—á–∏—Å—Ç–∫–∞ –º–µ—Å—Ç–∞ –≤ –ë-–¥–µ—Ä–µ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö. –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ª–∏–≤–∞–µ—Ç –∏ –Ω–µ
  —É–¥–∞–ª—è–µ—Ç –±–ª–æ–∫–∏ –ë-–¥–µ—Ä–µ–≤–∞, —Ç–∞–∫ —á—Ç–æ –≤ —Ç–µ–æ—Ä–∏–∏ –¥–µ—Ä–µ–≤–æ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–æ—Å—Ç–∏—Å—å –∏ —Å—Ç–∞—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º.
  –ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—ë—Ç–µ—Å—å —Å —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π —Å–µ–π—á–∞—Å, –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å –µ—ë —Å –ø–æ–º–æ—â—å—é
  –∫–æ–º–∞–Ω–¥ `vitastor-kv dumpjson` –∏ `loadjson` (—Ç.–µ. –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤ –∏ –∑–∞–≥—Ä—É–∑–∏–≤ –æ–±—Ä–∞—Ç–Ω–æ –≤—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –§–°).
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. –£ VitastorFS –Ω–µ—Ç –∂—É—Ä–Ω–∞–ª–∞, —Ç–∞–∫ –∫–∞–∫
  –∂—É—Ä–Ω–∞–ª –±—ã —Å–∏–ª—å–Ω–æ –∑–∞–º–µ–¥–ª–∏–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ
  —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ CAS (—Å—Ä–∞–≤–Ω–∏—Ç—å-–∏-–∑–∞–ø–∏—Å–∞—Ç—å), –∏ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–µ—à—Ç–∞—Ç–Ω–æ–º
  –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ –§–° –≤ –ë–î —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ "–º—É—Å–æ—Ä–Ω—ã–µ"
  –∑–∞–ø–∏—Å–∏. –§–° —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–∞–∫, —á—Ç–æ –Ω–∞ —Ä–∞–±–æ—Ç—É –æ–Ω–∏ –Ω–µ –≤–ª–∏—è—é—Ç, –Ω–æ –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –∏ –∏—Ö —Å—Ç–æ–∏—Ç
  —É–º–µ—Ç—å –ø–æ–¥—á–∏—â–∞—Ç—å.

## –†–∞–∑–º–µ—Ä –∑–∞–ø–∏—Å–∏ Linux NFS

–ö–ª–∏–µ–Ω—Ç Linux NFS (–º–æ–¥—É–ª–∏ —è–¥—Ä–∞ nfs/nfsv3/nfsv4) –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ –∫–æ–¥–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π
—Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞, —Ä–∞–≤–Ω—ã–π 1 –ú–ë - —Å–º. `rsize` –∏ `wsize` –≤ [man 5 nfs](https://linux.die.net/man/5/nfs).

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–≥–¥–∞ –≤—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç–µ –≤ —Ñ–∞–π–ª –≤ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ NFS —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ,
–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–ø–∏—Å–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 1 –ú–ë, –¥–∞–∂–µ –≤ —Ä–µ–∂–∏–º–µ O_DIRECT –∏ –¥–∞–∂–µ –µ—Å–ª–∏
–∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–ø–∏—Å–∏ –±—ã–ª –±–æ–ª—å—à–µ.

–û–¥–Ω–∞–∫–æ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–∏–Ω–µ–π–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ Vitastor –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ EC-–ø—É–ª–æ–≤
(–ø—É–ª–æ–≤ —Å –∫–æ–¥–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –æ—à–∏–±–æ–∫) –∑–∞–ø—Ä–æ—Å—ã –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ —Ä–∞–∑–º–µ—Ä—É –∫—Ä–∞—Ç–Ω—ã
[block_size](../config/layout-cluster.ru.md#block_size), —É–º–Ω–æ–∂–µ–Ω–Ω–æ–º—É –Ω–∞ —á–∏—Å–ª–æ —á–∞—Å—Ç–µ–π
–¥–∞–Ω–Ω—ã—Ö –ø—É–ª–∞ ([pg_size](../config/pool.ru.md#pg_size)-[parity_chunks](../config/pool.ru.md#parity_chunks)).
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–ø–∏—Å–∏ –º–µ–Ω—å—à–µ –∏–ª–∏ –Ω–µ –∫—Ä–∞—Ç–Ω—ã, —Ç–æ Vitastor –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å
—Å –¥–∏—Å–∫–æ–≤ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –ø–∞—Ä–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏ —á—ë—Ç–Ω–æ—Å—Ç–∏ –∏ —Ç–æ–ª—å–∫–æ
–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø–∏—Å–∞—Ç—å –∏—Ö –Ω–∞ –¥–∏—Å–∫–∏. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, —ç—Ç–æ –≤ 2-3 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø–∏—Å–∏
–Ω–∞ –¥–∏—Å–∫.

–ü—Ä–∏ —ç—Ç–æ–º block_size –Ω–∞ –∂—ë—Å—Ç–∫–∏—Ö –¥–∏—Å–∫–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ä–∞–≤–Ω—ã–º 1 –ú–ë.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ EC 2+1 –∏ HDD, –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –≤–∞–º
–Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã NFS-–∫–ª–∏–µ–Ω—Ç –ø–∏—Å–∞–ª –ø–æ 2 –ú–ë, –µ—Å–ª–∏ EC 4+1 –∏ HDD - —Ç–æ –ø–æ 4 –ú–ë, –∏ —Ç.–ø.

–ê Linux NFS-–∫–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ 1 –ú–ë. üò¢

–ù–æ —ç—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å, –ø–µ—Ä–µ—Å–æ–±—Ä–∞–≤ –º–æ–¥—É–ª–∏ —è–¥—Ä–∞ Linux NFS üòâ ü§©! –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ
–ø–æ–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π NFS_MAX_FILE_IO_SIZE –≤ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–æ–º —Ñ–∞–π–ª–µ nfs_xdr.h,
–ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –º–æ–¥—É–ª–∏ NFS.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Debian (–≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–¥ root):

```
# —Å–∫–∞—á–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏ –º–æ–¥—É–ª–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —è–¥—Ä–∞ Linux
apt-get install linux-headers-`uname -r`

# –∑–∞–º–µ–Ω—è–µ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö NFS_MAX_FILE_IO_SIZE –Ω–∞ –∂–µ–ª–∞–µ–º—ã–π (–∑–¥–µ—Å—å 4194304 - 4 –ú–ë)
sed -i 's/NFS_MAX_FILE_IO_SIZE\s*.*/NFS_MAX_FILE_IO_SIZE\t(4194304U)/' /lib/modules/`uname -r`/source/include/linux/nfs_xdr.h

# —Å–∫–∞—á–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ —è–¥—Ä–∞
mkdir linux_src
cd linux_src
apt-get source linux-image-`uname -r`-unsigned

# —Å–æ–±–∏—Ä–∞–µ–º –º–æ–¥—É–ª–∏ NFS
cd linux-*/fs/nfs
make -C /lib/modules/`uname -r`/build M=$PWD -j8 modules
make -C /lib/modules/`uname -r`/build M=$PWD modules_install

# —É–±–∏—Ä–∞–µ–º –≤ —Å—Ç–æ—Ä–æ–Ω—É —à—Ç–∞—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ NFS
mv /lib/modules/`uname -r`/kernel/fs/nfs ~/nfs_orig_`uname -r`
depmod -a

# –≤—ã–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –º–æ–¥—É–ª–∏ –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ
rmmod nfsv3 nfs
modprobe nfsv3
```

–ü–æ—Å–ª–µ —Ç–∞–∫–æ–π (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–µ—Ö–∏—Ç—Ä–æ–π üôÇ) –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ NFS –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –Ω–æ–≤—ã–º–∏ wsize –∏ rsize, –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏–Ω–µ–π–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ Vitastor-NFS
–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

## –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–ª–∏–µ–Ω—Ç Linux NFS 3.0 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.
–¢–æ –µ—Å—Ç—å, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –§–°.

–û–¥–Ω–∞–∫–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
–∏–ª–∏ —Å—Ö–µ–º—ã —Å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é. –≠—Ç–æ —Ç–æ—á–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö `immediate_commit=all` –∏
`client_enable_writeback=false`, —Ç–∞–∫ –∫–∞–∫ —Å –Ω–∏–º–∏ NFS-—Å–µ—Ä–≤–µ—Ä Vitastor –≤–æ–æ–±—â–µ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç
–≤ –ø–∞–º—è—Ç–∏ –µ—â—ë –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–∞—Ö –¥–∞–Ω–Ω—ã–µ; –∏ –≤–ø–æ–ª–Ω–µ –≤–µ—Ä–æ—è—Ç–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ
–¥–∞–∂–µ –±–µ–∑ `immediate_commit=all`, –ø–æ—Ç–æ–º—É —á—Ç–æ NFS-–∫–ª–∏–µ–Ω—Ç —è–¥—Ä–∞ Linux –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –≤—Å–µ
–Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

## RDMA

vitastor-nfs –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç NFS —á–µ—Ä–µ–∑ RDMA. –í —Ç–µ–æ—Ä–∏–∏ —ç—Ç–æ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω–æ –ø–æ–∑–≤–æ–ª—è—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
VitastorFS –∏–∑ GPUDirect.

–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å NFS-RDMA, –¥–∞–∂–µ –µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç RDMA-–∫–∞—Ä—Ç—ã, —Å –ø–æ–º–æ—â—å—é SoftROCE:

1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ SoftROCE —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞ –æ–±–æ–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö: `rdma link add rxe0 type rxe netdev eth0`.
   –£—Ç–∏–ª–∏—Ç–∞ `rdma` –≤—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–∞–≤ –ø–∞–∫–µ—Ç–∞ iproute2, –∞ `eth0` –≤–∞–º –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∏–º—è —Å–≤–æ–µ–π
   —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã.

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ vitastor-nfs —Å RDMA: `vitastor-nfs start (--fs <NAME> | --block) --pool <POOL> --port 20049 --nfs_rdma 20049 --portmap 0`

3. –°–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –§–°: `mount 192.168.0.10:/mnt/test/ /mnt/vita/ -o port=20049,mountport=20049,nfsvers=3,soft,nolock,rdma`

## –ö–æ–º–∞–Ω–¥—ã

### mount

`vitastor-nfs (--fs <NAME> | --block) mount [-o <OPT>] <MOUNTPOINT>`

–ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –§–° –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é <MOUNTPOINT>.

–ß—Ç–æ–±—ã –æ—Ç–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –§–°, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—É—é –∫–æ–º–∞–Ω–¥—É `umount <MOUNTPOINT>`.

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –§–°.

- `-o|--options <OPT>` - –ü–µ—Ä–µ–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è NFS (–ø—Ä–∏–º–µ—Ä: -o async).

### start

`vitastor-nfs (--fs <NAME> | --block) start`

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ç–µ–≤–æ–π NFS-—Å–µ—Ä–≤–µ—Ä. –û–ø—Ü–∏–∏:

| <!-- -->               | <!-- -->                                                                                                                    |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| `--bind <IP>`          | –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ –∞–¥—Ä–µ—Å—É \<IP> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.0.0.0 - –Ω–∞ –≤—Å–µ—Ö)                                                       |
| `--port <PORT>`        | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç \<PORT> –¥–ª—è NFS-—Å–µ—Ä–≤–∏—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2049). –£–∫–∞–∂–∏—Ç–µ "auto", —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∏ –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç   |
| `--portmap 0`          | –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å portmap/rpcbind –Ω–∞ –ø–æ—Ä—Ç—É 111 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á—ë–Ω –∏ —Ç—Ä–µ–±—É–µ—Ç root –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π)                              |
| `--nfs_rdma <PORT>`    | –≤–∫–ª—é—á–∏—Ç—å NFS-RDMA –Ω–∞ –ø–æ—Ä—Ç—É RDMA-CM \<PORT> (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ 20049). –ï—Å–ª–∏ RDMA –≤–∫–ª—é—á–µ–Ω–æ –∏ —É–∫–∞–∑–∞–Ω–æ `--port 0`, TCP –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–æ |
| `--nfs_rdma_credit 16` | –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π "–∫—Ä–µ–¥–∏—Ç", –≥–ª—É–±–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è NFS-–∫–ª–∏–µ–Ω—Ç–æ–≤                                                                     |
| `--nfs_rdma_send 1024` | –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–π RDMA –æ—Ç–ø—Ä–∞–≤–∫–∏ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ nfs_rdma_credit)                                              |
| `--nfs_rdma_alloc 1M`  | –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –¥–ª—è RDMA-–∫–ª–∏–µ–Ω—Ç–æ–≤                                                                               |
| `--nfs_rdma_gc 64M`    | –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏ RDMA-–∫–ª–∏–µ–Ω—Ç–æ–º –ø–µ—Ä–µ–¥ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º                                                  |

### upgrade

`vitastor-nfs --fs <NAME> upgrade`

–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –§–°. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–Ω–ª–∞–π–Ω (–ø—Ä–∏ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö NFS), –Ω–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Ö –≤—Å—ë
–∂–µ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å.

### defrag

`vitastor-nfs --fs <NAME> defrag [OPTIONS] [--dry-run]`

–î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–º–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–ª–∫–∏—Ö —Ñ–∞–π–ª–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª–µ–µ, —á–µ–º
<defrag_percent> –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö —É–¥–∞–ª–µ–Ω–æ. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–Ω–ª–∞–π–Ω.

–ù–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –§–° —Ñ–∞–π–ª—ã, –º–µ–Ω—å—à–∏–µ, —á–µ–º —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –ø—É–ª–∞ (block_size —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ —á–∏—Å–ª–æ
—á–∞—Å—Ç–µ–π –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –ø—É–ª EC), —É–ø–∞–∫–æ–≤—ã–≤–∞—é—Ç—Å—è –¥—Ä—É–≥ –∑–∞ –¥—Ä—É–≥–æ–º –≤ –±–æ–ª—å—à–∏–µ "—Ç–æ–º–∞" / "–æ–±—â–∏–µ –∏–Ω–æ–¥—ã".
–ö–æ–≥–¥–∞ —Ç–∞–∫–∏–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–ª–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è, –æ–Ω–∏ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –∏ –æ—Å—Ç–∞–≤–ª—è—é—Ç –∑–∞ —Å–æ–±–æ–π "–º—É—Å–æ—Ä".

–ü—Ä–∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –º—É—Å–æ—Ä —É–¥–∞–ª—è–µ—Ç—Å—è, –∞ –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –≤ –Ω–æ–≤—ã–µ —Ç–æ–º–∞.

–û–ø—Ü–∏–∏:

| <!-- -->                   | <!-- -->                                                                |
|----------------------------|------------------------------------------------------------------------ |
| `--volume_untouched 86400` | –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–º–∞, –≤ –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –Ω–µ –ø–∏—Å–∞–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ —Å–µ–∫—É–Ω–¥ |
| `--defrag_percent 50`      | –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–º–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —ç—Ç–æ—Ç % –¥–∞–Ω–Ω—ã—Ö —É–¥–∞–ª—ë–Ω           |
| `--defrag_block_count 16`  | –ß–∏—Ç–∞—Ç—å —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –ø—É–ª–∞ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑                           |
| `--defrag_iodepth 16`      | –ü–µ—Ä–µ–º–µ—â–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ —ç—Ç–æ–≥–æ —á–∏—Å–ª–∞ —Ñ–∞–π–ª–æ–≤                           |
| `--trace`                  | –ü–µ—á–∞—Ç–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏                            |
| `--dry-run`                | –ù–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞—Ç—å –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è   |
| `--recalc-stats`           | –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Å–µ—Ö —Ç–æ–º–æ–≤                           |
| `--include-empty`          | –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∏ –ø—É—Å—Ç—ã–µ —Ç–æ–º–∞; –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ NFS-—Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –æ–ø—Ü–∏–∏ |
| `--no-rm`                  | –ü–µ—Ä–µ–º–µ—â–∞—Ç—å, –Ω–æ –Ω–µ —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ                                        |

## –û–±—â–∏–µ –æ–ø—Ü–∏–∏

| <!-- -->           | <!-- -->                                                |
|--------------------|---------------------------------------------------------|
| `--fs <NAME>`      | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VitastorFS —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –≤ –æ–±—Ä–∞–∑–µ \<NAME>  |
| `--block`          | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Å–µ–≤–¥–æ-–§–° –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–ª–æ—á–Ω—ã–º –æ–±—Ä–∞–∑–∞–º    |
| `--pool <POOL>`    | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–ª \<POOL> –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –ø—É–ª –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –Ω–µ –æ–¥–∏–Ω) |
| `--subdir <DIR>`   | —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥ \<DIR>, –∞ –Ω–µ –∫–æ—Ä–µ–Ω—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Å–µ–≤–¥–æ-–§–°) |
| `--nfspath <PATH>` | —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å NFS-—ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ \<PATH> (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é /) |
| `--pidfile <FILE>` | –∑–∞–ø–∏—Å–∞—Ç—å ID –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∑–∞–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª                    |
| `--logfile <FILE>` | –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏ –≤ –∑–∞–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª                         |
| `--foreground 1`   | –Ω–µ —É—Ö–æ–¥–∏—Ç—å –≤ —Ñ–æ–Ω –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞                          |
